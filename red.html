<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Диагностика Красной Струны</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #dc2626;
            background-image: linear-gradient(135deg, #dc2626 0%, #991b1b 30%, #7f1d1d 60%, #450a0a 100%);
            min-height: 100vh;
            color: #ffffff;
            overflow-x: hidden;
            position: relative;
            font-size: 22px;
            line-height: 1.7;
        }

        /* Glassmorphism Background Effects */
        .bg-orbs {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .orb {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(45deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            backdrop-filter: blur(20px);
            animation: float 20s infinite ease-in-out;
        }

        /* Отключаем анимации на мобильных устройствах */
        @media (max-width: 768px) {
            .orb {
                animation: none;
                transform: none;
            }
        }

        .orb:nth-child(1) {
            width: 300px;
            height: 300px;
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .orb:nth-child(2) {
            width: 200px;
            height: 200px;
            top: 60%;
            right: 15%;
            animation-delay: -7s;
        }

        .orb:nth-child(3) {
            width: 400px;
            height: 400px;
            bottom: 10%;
            left: 20%;
            animation-delay: -14s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-30px) rotate(180deg); }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 10;
        }

        /* Glassmorphism Cards */
        .glass-card {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(25px);
            border-radius: 24px;
            border: 2px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 12px 40px rgba(31, 38, 135, 0.5);
            padding: 60px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
        }

        .header {
            text-align: center;
            margin-bottom: 60px;
            animation: slideDown 1.2s ease-out;
        }

        .header h1 {
            font-size: 5.5rem;
            font-weight: 800;
            margin-bottom: 40px;
            background: linear-gradient(135deg, #ffffff, #fecaca, #dc2626);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
            text-transform: uppercase;
            animation: glow 3s ease-in-out infinite alternate;
            text-shadow: 0 6px 12px rgba(0,0,0,0.5);
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.8));
            word-wrap: break-word;
            hyphens: auto;
        }

        /* Отключаем анимацию свечения на мобильных */
        @media (max-width: 768px) {
            .header h1 {
                animation: none;
                filter: none;
            }
        }

        @keyframes glow {
            from { filter: drop-shadow(0 0 20px rgba(220, 38, 38, 0.8)); }
            to { filter: drop-shadow(0 0 30px rgba(239, 68, 68, 1)); }
        }

        .intro-text {
            font-size: 2rem;
            line-height: 1.8;
            color: #ffffff;
            text-align: center;
            font-weight: 600;
            text-shadow: 3px 3px 12px rgba(0,0,0,1);
            background: rgba(0,0,0,0.6);
            padding: 30px;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.3);
        }

        /* Bento Box Layout */
        .bento-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 28px;
            margin: 50px 0;
        }

        .bento-item {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.4);
            padding: 45px;
            transition: all 0.4s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            font-size: 1.5rem;
            font-weight: 600;
            color: #ffffff;
            text-shadow: 3px 3px 12px rgba(0,0,0,1);
            line-height: 1.6;
            background-image: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4));
        }

        .bento-item::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s;
        }

        .bento-item:hover::after {
            left: 100%;
        }

        .bento-item:hover {
            transform: translateY(-8px);
            background: rgba(255, 255, 255, 0.35);
            box-shadow: 0 25px 50px rgba(31, 38, 135, 0.6);
            border-color: rgba(255, 255, 255, 0.6);
        }

        .bento-item.selected {
            background: rgba(239, 68, 68, 0.4);
            border-color: rgba(239, 68, 68, 0.8);
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 30px 60px rgba(239, 68, 68, 0.5);
        }

        /* Color Palette Glassmorphism */
        .color-palette {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 35px;
            margin: 50px 0;
        }

        .color-option {
            height: 200px;
            border-radius: 24px;
            cursor: pointer;
            transition: all 0.4s ease;
            border: 3px solid rgba(255, 255, 255, 0.4);
            position: relative;
            backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .color-option::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.6), transparent);
            border-radius: 24px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .color-option:hover::before {
            opacity: 1;
        }

        .color-option:hover {
            transform: translateY(-12px) scale(1.05);
            box-shadow: 0 35px 70px rgba(0, 0, 0, 0.4);
        }

        .color-option.selected {
            border-color: rgba(255, 255, 255, 1);
            transform: translateY(-12px) scale(1.05);
            box-shadow: 0 0 60px rgba(255, 255, 255, 0.6);
        }

        .part4 { background: linear-gradient(135deg, #ff9a9e, #fecfef, #fecfef); }
        .part3 { background: linear-gradient(135deg, #ff6b6b, #ee5a52, #ff9a9e); }
        .part2 { background: linear-gradient(135deg, #e74c3c, #c0392b, #e74c3c); }
        .part1 { background: linear-gradient(135deg, #c0392b, #922b21, #8b0000); }
        .matrix { background: linear-gradient(135deg, #8d6e63, #5d4037, #3e2723); }

        /* 3D Buttons */
        .neo-btn {
            background: linear-gradient(145deg, #dc2626, #991b1b);
            border: none;
            color: white;
            padding: 28px 56px;
            border-radius: 20px;
            font-size: 1.8rem;
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 50px auto;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.4);
            text-shadow: 2px 2px 6px rgba(0,0,0,0.5);
            box-shadow: 0 8px 32px rgba(220, 38, 38, 0.4);
        }

        .neo-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s;
        }

        .neo-btn:hover::before {
            left: 100%;
        }

        .neo-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 45px rgba(220, 38, 38, 0.8);
            background: linear-gradient(145deg, #ef4444, #dc2626);
        }

        .neo-btn:active {
            transform: translateY(-2px);
        }

        /* Progress Bar */
        .progress-container {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(15px);
            border-radius: 50px;
            padding: 8px;
            margin-bottom: 50px;
            border: 2px solid rgba(255, 255, 255, 0.4);
        }

        .progress-fill {
            height: 20px;
            background: linear-gradient(90deg, #dc2626, #ef4444, #f87171);
            border-radius: 50px;
            transition: width 1s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(220, 38, 38, 0.6);
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Question Styles */
        .question-title {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 30px;
            text-align: center;
            color: #ffffff;
            letter-spacing: -0.01em;
            text-shadow: 4px 4px 16px rgba(0,0,0,1);
            background: rgba(0,0,0,0.7);
            padding: 25px;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .question-subtitle {
            font-size: 1.7rem;
            margin-bottom: 50px;
            text-align: center;
            color: #ffffff;
            font-weight: 600;
            text-shadow: 3px 3px 12px rgba(0,0,0,1);
            background: rgba(0,0,0,0.6);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .question-counter {
            text-align: center;
            font-size: 1.6rem;
            margin-bottom: 40px;
            font-weight: 700;
            color: #ffffff;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 3px 3px 12px rgba(0,0,0,1);
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.3);
        }

        /* Results */
        .result-title {
            font-size: 4rem;
            font-weight: 800;
            margin-bottom: 40px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: -0.02em;
            text-shadow: 4px 4px 16px rgba(0,0,0,1);
            background: rgba(0,0,0,0.7);
            padding: 30px;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .result-description {
            font-size: 1.8rem;
            line-height: 1.9;
            margin: 40px 0;
            color: #ffffff;
            text-align: center;
            font-weight: 600;
            text-shadow: 3px 3px 12px rgba(0,0,0,1);
            background: rgba(0,0,0,0.6);
            padding: 30px;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .recommendation-box {
            background: rgba(239, 68, 68, 0.3);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            margin: 40px 0;
            border: 2px solid rgba(239, 68, 68, 0.6);
            font-size: 1.5rem;
            font-weight: 600;
            text-shadow: 2px 2px 6px rgba(0,0,0,0.5);
            color: #ffffff;
        }

        /* Test Container */
        .test-container {
            display: none;
        }

        .test-container.active {
            display: block;
            animation: fadeInUp 0.8s ease-out;
        }

        .results {
            display: none;
            animation: fadeInUp 1s ease-out;
        }

        .results.show {
            display: block;
        }

        /* Animations */
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* State Colors */
        .tense { color: #ffa726; text-shadow: 0 0 25px #ffa726; }
        .slack { color: #42a5f5; text-shadow: 0 0 25px #42a5f5; }
        .broken { color: #ef5350; text-shadow: 0 0 25px #ef5350; }
        .normal { color: #66bb6a; text-shadow: 0 0 25px #66bb6a; }

        /* Mobile Optimization */
        @media (max-width: 768px) {
            body { 
                font-size: 18px;
                /* Отключаем все анимации для производительности */
                animation: none !important;
            }
            
            * {
                animation-duration: 0s !important;
                animation-delay: 0s !important;
                transition-duration: 0.1s !important;
            }
            
            .container { padding: 20px 15px; }
            .header h1 { 
                font-size: 2.8rem; 
                line-height: 1.1;
                word-break: break-word;
                hyphens: auto;
            }
            .intro-text { 
                font-size: 1.4rem; 
                padding: 20px; 
                line-height: 1.5;
            }
            .question-title { 
                font-size: 2rem; 
                padding: 15px;
                line-height: 1.2;
                word-break: break-word;
            }
            .question-subtitle { 
                font-size: 1.2rem; 
                padding: 15px; 
                line-height: 1.4;
            }
            .question-counter { 
                font-size: 1.1rem; 
                padding: 10px; 
                letter-spacing: 1px;
            }
            .glass-card { padding: 25px; }
            .color-palette { grid-template-columns: repeat(2, 1fr); gap: 15px; }
            .color-option { height: 120px; }
            .bento-grid { grid-template-columns: 1fr; gap: 15px; }
            .bento-item { 
                padding: 20px; 
                font-size: 1.1rem;
                line-height: 1.4;
            }
            .neo-btn { 
                padding: 18px 36px; 
                font-size: 1.3rem;
                margin: 30px auto;
            }
            .result-title { 
                font-size: 2.2rem; 
                padding: 20px;
                line-height: 1.2;
                word-break: break-word;
            }
            .result-description { 
                font-size: 1.3rem; 
                padding: 20px; 
                line-height: 1.5;
            }
            .recommendation-box { 
                padding: 25px; 
                font-size: 1.2rem;
                line-height: 1.5;
            }
        }

        @media (max-width: 480px) {
            body { font-size: 16px; }
            .header h1 { 
                font-size: 2.2rem;
                line-height: 1.1;
            }
            .intro-text { 
                font-size: 1.2rem; 
                padding: 15px;
                line-height: 1.4;
            }
            .question-title { 
                font-size: 1.6rem; 
                padding: 12px;
                line-height: 1.2;
            }
            .question-subtitle { 
                font-size: 1rem; 
                padding: 12px;
                line-height: 1.3;
            }
            .question-counter { 
                font-size: 0.9rem; 
                padding: 8px;
                letter-spacing: 0.5px;
            }
            .glass-card { padding: 20px; }
            .bento-item { 
                padding: 15px; 
                font-size: 1rem;
                line-height: 1.3;
            }
            .neo-btn { 
                padding: 15px 30px; 
                font-size: 1.1rem;
                margin: 25px auto;
            }
            .result-title { 
                font-size: 1.8rem; 
                padding: 15px;
                line-height: 1.1;
            }
            .result-description { 
                font-size: 1.1rem; 
                padding: 15px;
                line-height: 1.4;
            }
            .recommendation-box { 
                padding: 20px; 
                font-size: 1rem;
                line-height: 1.4;
            }
        }
    </style>
</head>
<body>
    <!-- Background Orbs -->
    <div class="bg-orbs">
        <div class="orb"></div>
        <div class="orb"></div>
        <div class="orb"></div>
    </div>

    <div class="container">
        <div class="header" id="header">
            <div class="glass-card">
                <h1>Диагностика Красной Струны</h1>
                <div class="intro-text">
                    <p><strong>Определите текущее состояние своей красной струны здоровья через уникальную диагностику на основе науки о времени.</strong></p>
                </div>
                <button class="neo-btn" id="startBtn">Начать диагностику</button>
            </div>
        </div>

        <div class="test-container" id="testContainer">
            <div class="progress-container">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="question-counter" id="questionCounter"></div>
            <div id="questionContent"></div>
        </div>

        <div class="results" id="results">
            <div class="glass-card">
                <h2 class="result-title">Результат диагностики</h2>
                <div class="result-title" id="stringState"></div>
                <div class="result-description" id="stateDescription"></div>
                <div class="recommendation-box" id="bookRecommendation"></div>
                <button class="neo-btn" id="showAnswersBtn">Просмотреть ответы</button>
                <button class="neo-btn" id="restartBtn">Пройти еще раз</button>
            </div>
        </div>
    </div>

    <script>
        var currentQuestion = 0;
        var answers = {};

        var questions = [
            {
                id: 'color',
                title: 'Выберите цвет, который вас притягивает',
                subtitle: 'Цветовая диагностика красной струны',
                type: 'color',
                colors: [
                    { class: 'part4', value: 'part4' },
                    { class: 'part3', value: 'part3' },
                    { class: 'part2', value: 'part2' },
                    { class: 'part1', value: 'part1' },
                    { class: 'matrix', value: 'matrix' }
                ]
            },
            {
                id: 'movement',
                title: 'Как вы оцениваете свою физическую активность?',
                subtitle: 'Красная струна отвечает за движения',
                type: 'options',
                options: [
                    { text: 'Мои движения четкие, целенаправленные, но иногда чувствую ограничения', value: 'tense' },
                    { text: 'Двигаюсь много, но хаотично, без системы и порядка', value: 'slack' },
                    { text: 'Движений очень мало, часто чувствую слабость и усталость', value: 'broken' },
                    { text: 'Мои движения гармоничны, чувствую радость от активности', value: 'normal' }
                ]
            },
            {
                id: 'health',
                title: 'Как вы характеризуете свое здоровье?',
                subtitle: 'Красная струна - цвет здоровья',
                type: 'options',
                options: [
                    { text: 'Здоровье хорошее, но чувствую некоторую скованность', value: 'tense' },
                    { text: 'Энергии много, но она нестабильна, скачет', value: 'slack' },
                    { text: 'Часто болею, чувствую упадок сил', value: 'broken' },
                    { text: 'Доволен здоровьем, активно занимаюсь телом', value: 'normal' }
                ]
            },
            {
                id: 'names',
                title: 'Сколько людей с именами Елена и Дмитрий в вашем окружении?',
                subtitle: 'Имена Елена-Дмитрий звучат на красной струне',
                type: 'options',
                options: [
                    { text: 'Много Елен вокруг меня', value: 'tense' },
                    { text: 'Много Дмитриев в окружении', value: 'slack' },
                    { text: 'И Елены, и Дмитрии примерно поровну', value: 'normal' },
                    { text: 'Мало таких имен или не обращаю внимания', value: 'few' }
                ]
            },
            {
                id: 'redcolor',
                title: 'Какое у вас отношение к красному цвету?',
                subtitle: 'Красный - цвет здоровья и красной струны',
                type: 'options',
                options: [
                    { text: 'Нравится, но использую дозированно', value: 'tense' },
                    { text: 'Обожаю красный, часто его выбираю', value: 'slack' },
                    { text: 'Избегаю красного цвета', value: 'broken' },
                    { text: 'Нравится красный, использую гармонично', value: 'normal' }
                ]
            },
            {
                id: 'providing',
                title: 'Как вы обеспечиваете себя необходимым для жизни?',
                subtitle: 'Красная струна связана с обеспечением жизни',
                type: 'options',
                options: [
                    { text: 'Обеспечиваю стабильно, но с большими усилиями', value: 'tense' },
                    { text: 'То густо, то пусто - очень нестабильно', value: 'slack' },
                    { text: 'С трудом обеспечиваю базовые потребности', value: 'broken' },
                    { text: 'Легко обеспечиваю себя всем необходимым', value: 'normal' }
                ]
            },
            {
                id: 'support',
                title: 'На кого вы больше опираетесь в жизни?',
                subtitle: 'Выбор опор влияет на состояние струны',
                type: 'options',
                options: [
                    { text: 'Только на маму', value: 'tense' },
                    { text: 'Только на папу', value: 'slack' },
                    { text: 'На маму и папу (на обоих)', value: 'normal' },
                    { text: 'Только на себя', value: 'broken' }
                ]
            },
            {
                id: 'month',
                title: 'В каком месяце вы родились?',
                subtitle: 'Ноябрь - месяц красной струны',
                type: 'options',
                options: [
                    { text: 'Ноябрь', value: 'normal' },
                    { text: 'Весенние месяцы (март, апрель, май)', value: 'tense' },
                    { text: 'Летние месяцы (июнь, июль, август)', value: 'slack' },
                    { text: 'Другие осенне-зимние месяцы', value: 'broken' }
                ]
            },
            {
                id: 'myname',
                title: 'Как вас зовут?',
                subtitle: 'Ваше собственное имя влияет на красную струну',
                type: 'options',
                options: [
                    { text: 'Меня зовут Елена', value: 'elena' },
                    { text: 'Меня зовут Дмитрий', value: 'dmitry' },
                    { text: 'Другое имя', value: 'other' },
                    { text: 'Предпочитаю не говорить', value: 'private' }
                ]
            },
            {
                id: 'weekday',
                title: 'В какой день недели вы родились?',
                subtitle: 'Воскресенье - день красной струны',
                type: 'options',
                options: [
                    { text: 'Воскресенье', value: 'normal' },
                    { text: 'Понедельник', value: 'monday' },
                    { text: 'Вторник', value: 'tuesday' },
                    { text: 'Среда', value: 'wednesday' },
                    { text: 'Четверг', value: 'thursday' },
                    { text: 'Пятница', value: 'friday' },
                    { text: 'Суббота', value: 'saturday' },
                    { text: 'Не знаю', value: 'unknown' }
                ]
            }
        ];

        var stringStates = {
            tense: {
                name: 'НАТЯНУТАЯ СТРУНА',
                description: 'Ваша красная струна натянута. Проявляется тем, что у вас начинаются потери и резкое сокращение движений. Вы чувствуете скованность, ограничения, но при этом сохраняете стабильность.'
            },
            slack: {
                name: 'ПРОВИСШАЯ СТРУНА', 
                description: 'Ваша красная струна провисла. Эти струны слишком ослаблены. Если вы много и беспорядочно двигаетесь – провисла красная струна. Энергия есть, но она неуправляема.'
            },
            broken: {
                name: 'ПОРВАННАЯ СТРУНА',
                description: 'Ваша красная струна порвана. Это самая крайняя степень деформации. Если у человека рвётся красная струна, он начинает болеть. Вы теряете опору и выпадаете из знаковой системы этого мира.'
            },
            normal: {
                name: 'СТРУНА В ПОРЯДКЕ',
                description: 'Ваша красная струна в порядке! Вы чувствуете гармонию в движениях, здоровье в норме, энергия течет свободно. У вас есть баланс между активностью и покоем. Красный цвет дарит вам состояние радости и наполненности жизни.'
            }
        };

        function init() {
            document.getElementById('startBtn').addEventListener('click', startTest);
            document.getElementById('restartBtn').addEventListener('click', restartTest);
            document.getElementById('showAnswersBtn').addEventListener('click', showAnswers);
        }

        function startTest() {
            currentQuestion = 0;
            answers = {};
            
            document.getElementById('header').style.display = 'none';
            document.getElementById('results').classList.remove('show');
            document.getElementById('testContainer').classList.add('active');
            showQuestion();
        }

        function showQuestion() {
            var question = questions[currentQuestion];
            var questionContent = document.getElementById('questionContent');
            var progressFill = document.getElementById('progressFill');
            var questionCounter = document.getElementById('questionCounter');
            
            progressFill.style.width = ((currentQuestion + 1) / questions.length * 100) + '%';
            questionCounter.innerHTML = 'Вопрос ' + (currentQuestion + 1) + ' из ' + questions.length;
            
            var html = '<div class="glass-card">';
            html += '<div class="question-title">' + question.title + '</div>';
            html += '<div class="question-subtitle">' + question.subtitle + '</div>';
            
            if (question.type === 'color') {
                html += '<div class="color-palette">';
                for (var i = 0; i < question.colors.length; i++) {
                    var color = question.colors[i];
                    html += '<div class="color-option ' + color.class + '" data-value="' + color.value + '"></div>';
                }
                html += '</div>';
            } else {
                html += '<div class="bento-grid">';
                for (var i = 0; i < question.options.length; i++) {
                    var option = question.options[i];
                    html += '<div class="bento-item" data-value="' + option.value + '">';
                    html += option.text;
                    html += '</div>';
                }
                html += '</div>';
            }
            
            html += '<button class="neo-btn" id="nextBtn" style="display: none;">Следующий вопрос</button>';
            html += '</div>';
            
            questionContent.innerHTML = html;
            
            // Добавляем обработчики событий после создания элементов
            if (question.type === 'color') {
                document.querySelectorAll('.color-option').forEach(function(el) {
                    el.addEventListener('click', function() {
                        selectColor(this.getAttribute('data-value'));
                    });
                });
            } else {
                document.querySelectorAll('.bento-item').forEach(function(el) {
                    el.addEventListener('click', function() {
                        selectOption(this.getAttribute('data-value'));
                    });
                });
            }
            
            document.getElementById('nextBtn').addEventListener('click', nextQuestion);
        }

        function selectColor(value) {
            answers[questions[currentQuestion].id] = value;
            
            // Убираем выделение со всех цветов
            var allColors = document.querySelectorAll('.color-option');
            for (var i = 0; i < allColors.length; i++) {
                allColors[i].classList.remove('selected');
            }
            
            // Находим и выделяем выбранный цвет
            var selectedColors = document.querySelectorAll('.color-option[data-value="' + value + '"]');
            for (var i = 0; i < selectedColors.length; i++) {
                selectedColors[i].classList.add('selected');
            }
            
            document.getElementById('nextBtn').style.display = 'block';
        }

        function selectOption(value) {
            answers[questions[currentQuestion].id] = value;
            
            // Убираем выделение со всех элементов
            var allItems = document.querySelectorAll('.bento-item');
            for (var i = 0; i < allItems.length; i++) {
                allItems[i].classList.remove('selected');
            }
            
            // Находим и выделяем выбранный элемент
            var selectedItems = document.querySelectorAll('.bento-item[data-value="' + value + '"]');
            for (var i = 0; i < selectedItems.length; i++) {
                selectedItems[i].classList.add('selected');
            }
            
            document.getElementById('nextBtn').style.display = 'block';
        }

        function nextQuestion() {
            currentQuestion++;
            
            if (currentQuestion < questions.length) {
                showQuestion();
            } else {
                showResults();
            }
        }

        function analyzeStringState() {
            var movement = answers.movement;
            var health = answers.health;
            var names = answers.names;
            var support = answers.support;
            var month = answers.month;
            var weekday = answers.weekday;
            var myname = answers.myname;
            
            // Подсчет совпадений с красной струной (ведущая)
            var redStringMatches = 0;
            var totalRedChecks = 5;
            
            if (month === 'normal') redStringMatches++;
            if (weekday === 'normal') redStringMatches++;
            if (health === 'normal') redStringMatches++;
            if (myname === 'elena' || myname === 'dmitry') redStringMatches++;
            if (support === 'normal') redStringMatches++;
            
            // Анализ по ключевым признакам состояния струны
            var tenseSigns = 0;
            var slackSigns = 0;
            var brokenSigns = 0;
            var normalSigns = 0;
            
            if (movement === 'tense') tenseSigns += 2;
            if (movement === 'slack') slackSigns += 2;
            if (movement === 'broken') brokenSigns += 2;
            if (movement === 'normal') normalSigns += 2;
            
            if (health === 'tense') tenseSigns++;
            if (health === 'slack') slackSigns++;
            if (health === 'broken') brokenSigns += 2;
            if (health === 'normal') normalSigns++;
            
            if (names === 'tense') tenseSigns++;
            if (names === 'slack') slackSigns++;
            if (names === 'normal') normalSigns++;
            if (names === 'few') normalSigns++; // "мало имен" = нормально
            
            if (support === 'tense') tenseSigns++;
            if (support === 'slack') slackSigns++;
            if (support === 'normal') normalSigns++;
            if (support === 'broken') brokenSigns++;
            
            if (month === 'normal') normalSigns++;
            if (weekday === 'normal') normalSigns++;
            
            var maxSigns = Math.max(tenseSigns, slackSigns, brokenSigns, normalSigns);
            
            // Проверка на противоречия
            var hasContradictions = false;
            if (movement === 'normal' && health === 'broken') hasContradictions = true;
            if (movement === 'broken' && health === 'normal') hasContradictions = true;
            if (movement === 'slack' && health === 'tense') hasContradictions = true;
            
            if (hasContradictions) {
                return { state: 'contradiction', redMatches: redStringMatches, totalChecks: totalRedChecks };
            }
            
            var state = 'normal';
            if (normalSigns === maxSigns) state = 'normal';
            else if (brokenSigns === maxSigns) state = 'broken';
            else if (slackSigns === maxSigns) state = 'slack';
            else if (tenseSigns === maxSigns) state = 'tense';
            
            return { state: state, redMatches: redStringMatches, totalChecks: totalRedChecks };
        }

        function showResults() {
            document.getElementById('testContainer').style.display = 'none';
            document.getElementById('results').classList.add('show');
            
            var analysis = analyzeStringState();
            var stateResult = analysis.state;
            var redMatches = analysis.redMatches;
            var totalChecks = analysis.totalChecks;
            
            if (stateResult === 'contradiction') {
                document.getElementById('stringState').innerHTML = 'ПРОТИВОРЕЧИВЫЕ ОТВЕТЫ';
                document.getElementById('stringState').className = 'result-title';
                document.getElementById('stateDescription').innerHTML = 
                    'Ваши ответы расходятся между собой. Для получения точного результата просим быть честным в ответах и пройти тест еще раз.';
                document.getElementById('bookRecommendation').innerHTML = 
                    '<h3>Рекомендация</h3>' +
                    '<p>Пройдите тест повторно, отвечая максимально честно на каждый вопрос.</p>';
                return;
            }
            
            var resultState = stringStates[stateResult];
            
            // Определяем книгу по выбранному цвету
            var colorChoice = answers.color;
            var bookTitle = '';
            
            switch(colorChoice) {
                case 'part4':
                    bookTitle = 'Откровенное Знакомство - Часть 4';
                    break;
                case 'part3':
                    bookTitle = 'Откровенное Знакомство - Часть 3';
                    break;
                case 'part2':
                    bookTitle = 'Откровенное Знакомство - Часть 2';
                    break;
                case 'part1':
                    bookTitle = 'Откровенное Знакомство - Часть 1';
                    break;
                case 'matrix':
                    bookTitle = 'Матрица Здоровья';
                    break;
                default:
                    bookTitle = 'Откровенное Знакомство';
            }
            
            // Проверка на ведущую струну
            var dominantInfo = '';
            if (redMatches >= 1) {
                dominantInfo = '<div style="background: rgba(220,38,38,0.3); backdrop-filter: blur(20px); padding: 30px; border-radius: 16px; border: 2px solid rgba(220,38,38,0.6); margin: 30px 0;">' +
                    '<h3 style="color: #ffffff; margin-bottom: 15px; text-transform: uppercase; font-size: 1.6rem; font-weight: 700; text-shadow: 2px 2px 6px rgba(0,0,0,0.7);">Красная струна ведущая</h3>' +
                    '<p style="font-size: 1.4rem; color: #ffffff; font-weight: 600; text-shadow: 2px 2px 6px rgba(0,0,0,0.5);">Найдено ' + redMatches + ' совпадений из ' + totalChecks + ' возможных</p>' +
                    '</div>';
            }
            
            document.getElementById('stringState').innerHTML = resultState.name;
            document.getElementById('stringState').className = 'result-title ' + stateResult;
            document.getElementById('stateDescription').innerHTML = resultState.description;
            document.getElementById('bookRecommendation').innerHTML = 
                '<h3 style="text-transform: uppercase; letter-spacing: 1px; margin-bottom: 20px; font-size: 1.8rem; color: #ffffff; font-weight: 700; text-shadow: 2px 2px 6px rgba(0,0,0,0.7);">Рекомендуемая книга</h3>' +
                '<h4 style="font-size: 2rem; margin: 20px 0; color: #ffffff; font-weight: 700; text-shadow: 2px 2px 8px rgba(0,0,0,0.8); background: rgba(239,68,68,0.4); padding: 20px; border-radius: 12px; border: 1px solid rgba(239,68,68,0.6);">' + bookTitle + '</h4>' +
                dominantInfo +
                '<div style="background: rgba(255,255,255,0.15); backdrop-filter: blur(15px); padding: 30px; border-radius: 16px; border: 2px solid rgba(255,255,255,0.25); margin-top: 30px;">' +
                '<p style="font-size: 1.4rem; font-style: italic; color: #ffffff; font-weight: 600; text-shadow: 2px 2px 6px rgba(0,0,0,0.5);">Для более точного определения состояния струны рекомендую обратиться к Ритмологу</p>' +
                '</div>';
        }

        function showAnswers() {
            var answersHtml = '<div style="background: rgba(255,255,255,0.15); backdrop-filter: blur(20px); padding: 40px; border-radius: 20px; margin: 40px 0; border: 2px solid rgba(255,255,255,0.25);">';
            answersHtml += '<h3 style="margin-bottom: 30px; text-transform: uppercase; font-size: 1.8rem; color: #ffffff; font-weight: 700; text-shadow: 2px 2px 6px rgba(0,0,0,0.7);">Ваши ответы</h3>';
            
            // Цвет
            var colorNames = {
                'part4': 'Светло-розовый (Часть 4)',
                'part3': 'Розово-красный (Часть 3)', 
                'part2': 'Красный (Часть 2)',
                'part1': 'Темно-красный (Часть 1)',
                'matrix': 'Коричневый (Матрица)'
            };
            answersHtml += '<p style="margin: 20px 0; font-size: 1.4rem; color: #ffffff; font-weight: 600; text-shadow: 2px 2px 6px rgba(0,0,0,0.5);"><strong>Выбранный цвет:</strong> ' + (colorNames[answers.color] || 'Не выбран') + '</p>';
            
            // Остальные ответы
            var questionTexts = {
                'movement': 'Физическая активность',
                'health': 'Здоровье', 
                'names': 'Имена в окружении',
                'redcolor': 'Отношение к красному',
                'providing': 'Обеспечение жизни',
                'support': 'Опора в жизни',
                'month': 'Месяц рождения',
                'myname': 'Ваше имя',
                'weekday': 'День недели рождения'
            };
            
            for (var key in answers) {
                if (key !== 'color' && questionTexts[key]) {
                    var selectedOption = getSelectedOptionText(key, answers[key]);
                    answersHtml += '<p style="margin: 20px 0; font-size: 1.4rem; color: #ffffff; font-weight: 600; text-shadow: 2px 2px 6px rgba(0,0,0,0.5);"><strong>' + questionTexts[key] + ':</strong> ' + selectedOption + '</p>';
                }
            }
            
            answersHtml += '</div>';
            
            document.getElementById('bookRecommendation').innerHTML += answersHtml;
            document.getElementById('showAnswersBtn').style.display = 'none';
        }
        
        function getSelectedOptionText(questionId, value) {
            var question = questions.find(function(q) { return q.id === questionId; });
            if (!question) return value;
            
            if (question.options) {
                var option = question.options.find(function(opt) { return opt.value === value; });
                return option ? option.text : value;
            }
            
            return value;
        }

        function restartTest() {
            location.reload();
        }

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
